# Микросервис для счетчиков статистики
## API методы:
- Метод сохранения статистики
- Метод показа статистики
- Метод сброса статистики

## Метод сохранения статистики.

Путь: localhost:8000/statistic/add/

Принимает на вход: 
- **date** - дата события
- **views** - количество показов
- **clicks** - количество кликов
- **cost** - стоимость кликов (в рублях с точностью до копеек)

Поля **views**, **clicks** и **cost** - опциональные.
Статистика агрегируется по дате.

Пример: {"views": 100, "clicks": 50, "cost": 70}

## Метод показа статистики

Путь: localhost:8000/statistic/show/

Принимает на вход:
- **from** - дата начала периода (включительно)
- **to** - дата окончания периода (включительно)

Отвечает статистикой, отсортированной по дате. В ответе должны быть поля:
- **date** - дата события
- **views** - количество показов
- **clicks** - количество кликов
- **cost** - стоимость кликов
- **cpc** = cost/clicks (средняя стоимость клика)
- **cpm** = cost/views * 1000 (средняя стоимость 1000 показов)

Пример: 

Запрос: {"from": "2021-11-01", "to": "2021-11-30", "sorted_by": "cost"}

Ответ: [
    {
        "id": 1,
        "views": 100,
        "clicks": 50,
        "cost": 70.0,
        "cpc": 1.4,
        "cpm": 700.0
    }
]

"sorted_by" определяет по какому полю будет производиться сортировка. Если его не указывать, то сортировка производится по дате добавления статистики.

## Метод сброса статистики

Путь: localhost:8000/statistic/delete/

Удаляет всю сохраненную статистику.

## Инструкция для запуска:

Вариант 1.

Запуск в Docker

Вариант 2.

Выполнить запросы записанные в файле DatabaseCreationRequests.txt для создания таблицы в базе данных и нового пользователя для неё.

В файле avito_api/settings.py раскоментировать строки:
- SECRET_KEY = ["123qwer"]
- DEBUG = [False]
- ALLOWED_HOSTS = []
 
И законметировать:
- SECRET_KEY = os.environ.get("SECRET_KEY")
- DEBUG = int(os.environ.get("DEBUG", default=0))
- ALLOWED_HOSTS = os.environ.get("DJANGO_ALLOWED_HOSTS").split(" ")
